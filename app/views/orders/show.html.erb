<style type="text/css">

    @media print
    {
        body * { visibility: hidden; }
        #printcontent * { visibility: visible; }
        #printcontent {
            background-color: white;
            height: 100%;
            width: 400px;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            z-index:1500;
            visibility: visible;
        }
    }
</style>
<%= form_with model: @order, local: true do |f| %>
  <div class="grid grid-cols-12 gap-6">
    <div class="col-span-12 xxl:col-span-9 grid grid-cols-12 gap-6">
      <div class="col-span-12 lg:col-span-12 mt-5">
        <div class="intro-y box p-5">
          <div class="mt-3">
            <div class="grid grid-cols-12 gap-2">
              <div class="col-span-3">
                <label>Захиалгын дугаар</label>
                <input class="input w-full border mt-2" value="<%= @order.id %>" disabled>
              </div>
              <div class="col-span-3">
                <label>Захиалга бүртгэсэн огноо</label>
                <input class="input w-full border mt-2" value="<%= @order.created_at.strftime('%Y-%m-%d %H:%M:%S') %>" disabled>
              </div>
              <div class="col-span-3">
                <label>Гүйлгээний огноо</label>
                <input class="input w-full border mt-2" value="<%= @order.transition_date %>" disabled>
              </div>
              <div class="col-span-3">
                <label>Ажилтан</label>
                <input class="input w-full border mt-2" value="<%= User.find_by_id(@order.user_id).email %>" disabled>
              </div>
            </div>
          </div>
          <div class="w-full border-t border-gray-200 dark:border-dark-5 border-dashed mt-3"></div>
          <div class="mt-3">
            <div class="grid grid-cols-12 gap-2">
              <div class="col-span-3">
                <label>Дансны дугаар</label>
                <input class="input w-full border mt-2" value="<%= @order.account_number %>" disabled>
              </div>
              <div class="col-span-3">
                <label>Утасны дугаар</label>
                <div class="relative mt-2">
                  <% if Client.find_by_phone_number(@order.phone_number).present? %>
                    <a href="/clients/<%= Client.find_by_phone_number(@order.phone_number).id %>" target="_blank">
                      <div class="absolute rounded-l  w-10 h-full flex items-center justify-center bg-gray-100 dark:bg-dark-1 dark:border-dark-4 border text-gray-600">
                        <i data-feather="external-link"></i>
                      </div>
                    </a>
                  <% end %>
                  <%= f.text_field :phone_number, class: "input pl-12 w-full border col-span-4" %>
                </div>
              </div>
              <div class="col-span-6">
                <label>Гүйлгээний утга</label>
                <input class="input w-full border mt-2" value="<%= @order.description %>" disabled>
              </div>
            </div>
          </div>
          <div class="w-full border-t border-gray-200 dark:border-dark-5 border-dashed mt-3"></div>

          <div class="overflow-x-auto">
            <table class="table">
              <thead>
              <tr>
                <th class="border border-b-2 dark:border-dark-5 whitespace-nowrap">#</th>
                <th class="border border-b-2 dark:border-dark-5 whitespace-nowrap">Бүтээгдэхүүн</th>
                <th class="border border-b-2 dark:border-dark-5 whitespace-nowrap">нэгж үнэ</th>
                <th class="border border-b-2 dark:border-dark-5 whitespace-nowrap">тоо ширхэг</th>
                <th class="border border-b-2 dark:border-dark-5 whitespace-nowrap">нийт</th>
                <th class="border border-b-2 dark:border-dark-5 whitespace-nowrap">карго</th>
              </tr>
              </thead>
              <tbody>
              <% @order_details.each do |order_detail| %>
                <tr>
                  <td class="border"><%= order_detail.id %></td>
                  <td class="border"><%=order_detail.product.name %></td>
                  <td class="border"><%= number_to_currency(order_detail.price, unit: "₮ ", strip_insignificant_zeros: true) %></td>
                  <td class="border"><%=order_detail.quantity %></td>
                  <td class="border"><%= number_to_currency(order_detail.price * order_detail.quantity, unit: "₮ ", strip_insignificant_zeros: true) %></td>
                  <td class="border"><%= number_to_currency(order_detail.cargo_price, unit: "₮ ", strip_insignificant_zeros: true) %> x <%= order_detail.quantity %> = <%= number_to_currency(order_detail.cargo_price * order_detail.quantity, unit: "₮ ", strip_insignificant_zeros: true) %></td>
                </tr>
              <%end %>
              <tr>
                <td colspan="4" class="border"><div class="lg:text-right font-extrabold">Шилжүүлсэн мөнгөн дүн: <%= number_to_currency(@order.amount, unit: "₮ ", strip_insignificant_zeros: true) %></div></td>
                <td class="border"><div class="font-extrabold"><%= number_to_currency(@total_product_price, unit: "₮ ", strip_insignificant_zeros: true) %></div></td>
                <td class="border"><div class="font-extrabold"><%= number_to_currency(@total_cargo_price, unit: "₮ ", strip_insignificant_zeros: true) %></div></td>
              </tr>
              </tbody>
            </table>
          </div>

          <div class="w-full border-t border-gray-200 dark:border-dark-5 border-dashed mt-3"></div>
          <%= f.submit "Хадгалах", :class => 'button bg-theme-1 w-full text-white mt-5', name: 'update' %>
        </div>
      </div>
    </div>
    <div class="col-span-12 xxl:col-span-3 xxl:border-l border-theme-5 -mb-10 pb-10">
      <div class="xxl:pl-6 grid grid-cols-12 gap-6">
        <div class="col-span-12 md:col-span-6 xl:col-span-4 xxl:col-span-12">
          <div class="mt-5">
            <div id="printcontent">
              <div class="box intro-y p-3">
                <img src="/images/logo.png" alt="Playhouse" class="mb-5">
                <div class="font-medium">Захиалгын дугаар: <%= @order.id %></div>
                <div class="w-full border-t border-gray-200 dark:border-dark-5 border-dashed"></div>
                <div class="font-medium">Захиалга бүртгэсэн огноо: <%= @order.created_at.strftime('%Y-%m-%d %H:%M:%S') %></div>
                <div class="w-full border-t border-gray-200 dark:border-dark-5 border-dashed"></div>
                <div class="font-medium">Дансны дугаар: <%= @order.account_number %></div>
                <div class="w-full border-t border-gray-200 dark:border-dark-5 border-dashed"></div>
                <div class="font-medium">Гүйлгээний утга: <%= @order.description %></div>
                <div class="w-full border-t border-gray-200 dark:border-dark-5 border-dashed"></div>
                <div class="font-medium">Утасны дугаар: <%= @order.phone_number %></div>
                <div class="w-full border-t border-gray-200 dark:border-dark-5 border-dashed"></div>
                <div class="font-medium">Гүйлгээний огноо: <%= @order.transition_date %></div>
                <div class="w-full border-t border-gray-200 dark:border-dark-5 border-dashed"></div>
                <div class="font-medium">Шилжүүлсэн мөнгөн дүн: <%= number_to_currency(@order.amount, unit: "₮", strip_insignificant_zeros: true) %></div>
                <div class="w-full border-t border-gray-200 dark:border-dark-5 border-dashed"></div>
                <div class="font-medium">Бүтээгдэхүүний үнэ: 1</div>
                <div class="w-full border-t border-gray-200 dark:border-dark-5 border-dashed"></div>
                <div class="font-medium">Каргоны үнэ: <%= number_to_currency(@order.cargo_price, unit: "₮", strip_insignificant_zeros: true) %></div>
                <div class="w-full border-t border-gray-200 dark:border-dark-5 border-dashed"></div>

                <div class="font-medium">Нийт төлөх дүн:<% if @order.cargo_price.present? %>  <%= number_to_currency(@order.amount + @order.cargo_price || 0, unit: "₮", strip_insignificant_zeros: true) %><% end %></div>
                <div class="w-full border-t border-gray-200 dark:border-dark-5 border-dashed"></div>
                <div>
                  <button class="button bg-theme-1 w-full text-white mt-5">Хэвлэх</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>